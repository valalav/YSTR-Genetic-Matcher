# –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π Sample Manager

## –î–∞—Ç–∞: 2025-10-11

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫—ç—à–∞ ("Apply Changes")

#### –ë—ç–∫–µ–Ω–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–§–∞–π–ª: `~/DNA-utils-universal/backend/routes/admin.js`**

–ò–∑–º–µ–Ω–µ–Ω–∏—è:
1. –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `requireApiKey` –∏–∑ middleware (—Å—Ç—Ä–æ–∫–∞ 5):
```javascript
const { requireApiKey } = require('../middleware/apiKeyAuth');
```

2. –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /api/admin/reload-cache` (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 408):
```javascript
// POST /api/admin/reload-cache - Reload cache (for Sample Manager)
// Requires API key with cache management permission
router.post('/reload-cache',
  requireApiKey('cache.clear'),
  asyncHandler(async (req, res) => {
    const { type = 'all' } = req.body;
    let clearedCount = 0;
    const clearedTypes = [];

    try {
      if (type === 'all' || type === 'matching') {
        await matchingService.clearMatchingCaches();
        clearedCount++;
        clearedTypes.push('matching');
      }

      if (type === 'all' || type === 'haplogroup') {
        const haplogroupService = require('../services/haplogroupService');
        await haplogroupService.redis.del('haplogroup:tree');
        clearedCount++;
        clearedTypes.push('haplogroup');
      }

      if (type === 'all' || type === 'profiles') {
        const haplogroupService = require('../services/haplogroupService');
        const keys = await haplogroupService.redis.keys('profile:*');
        if (keys.length > 0) {
          await haplogroupService.redis.del(...keys);
        }
        clearedCount++;
        clearedTypes.push('profiles');
      }

      res.json({
        success: true,
        message: `Cache reloaded successfully. Cleared ${clearedCount} cache type(s).`,
        clearedTypes,
        timestamp: new Date().toISOString(),
        apiKey: req.apiKey?.name || 'Unknown'
      });

    } catch (error) {
      console.error('‚ùå Cache reload error:', error);
      res.status(500).json({
        error: `Cache reload failed: ${error.message}`
      });
    }
  })
);
```

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –±—ç–∫–∞–ø–∞:** `~/DNA-utils-universal/backend/routes/admin.js.bak`

#### –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–§–∞–π–ª: `~/DNA-utils-universal/str-matcher/src/components/str-matcher/SampleManager.tsx`**

–ò–∑–º–µ–Ω–µ–Ω–∏—è:
1. –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–Ω–æ–ø–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 51):
```typescript
const [reloadingCache, setReloadingCache] = useState(false);
```

2. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫—ç—à–∞ (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 263):
```typescript
// Reload cache - clear backend cache and optionally reload page
const reloadCache = useCallback(async () => {
  setReloadingCache(true);
  setMessage(null);

  try {
    const response = await fetch(`${backendUrl}/api/admin/reload-cache`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-API-Key': apiKey
      },
      body: JSON.stringify({ type: 'all' })
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || error.error || 'Failed to reload cache');
    }

    const data = await response.json();
    setMessage({
      type: 'success',
      text: `‚úÖ ${data.message} Cache types cleared: ${data.clearedTypes.join(', ')}`
    });

    // Optionally reload the page after a short delay to refresh all data
    setTimeout(() => {
      window.location.reload();
    }, 1500);
  } catch (error) {
    setMessage({
      type: 'error',
      text: `Failed to reload cache: ${error instanceof Error ? error.message : 'Unknown error'}`
    });
  } finally {
    setReloadingCache(false);
  }
}, [apiKey, backendUrl]);
```

3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "Apply Changes" –≤ UI (—Å—Ç—Ä–æ–∫–∞ 310):
```typescript
<div className="flex gap-2 mt-2 items-center justify-between">
  <div className="flex gap-2">
    {/* –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–Ω–æ–ø–∫–∏ Add/Edit/Bulk */}
  </div>
  <Button
    onClick={reloadCache}
    disabled={reloadingCache}
    variant="outline"
    className="bg-green-600 hover:bg-green-700 text-white"
  >
    {reloadingCache ? 'üîÑ Reloading...' : 'üîÑ Apply Changes'}
  </Button>
</div>
```

---

### 2. ‚úÖ –°–æ–∑–¥–∞–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è API –∫–ª—é—á–∞–º–∏

**–ù–æ–≤—ã–π —Ñ–∞–π–ª: `~/DNA-utils-universal/str-matcher/src/app/admin/keys/page.tsx`**

–ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á API
- –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –≤ sessionStorage
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã—Ö–æ–¥

#### –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏

**–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–ª—é—á–µ–π:**
- –ò–º—è –∫–ª—é—á–∞ (–¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞)
- –û–ø–∏—Å–∞–Ω–∏–µ
- –°—Ç–∞—Ç—É—Å (–ê–∫—Ç–∏–≤–µ–Ω/–ù–µ–∞–∫—Ç–∏–≤–µ–Ω/–ò—Å—Ç—ë–∫)
- –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (badges)
- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è, –∏—Å—Ç–µ—á–µ–Ω–∏—è, –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –°—á—ë—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π

**–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π:**
- –ü–æ–ª–µ –∏–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–ª—é—á –ò–≤–∞–Ω–∞ –ò–≤–∞–Ω–æ–≤–∞")
- –ü–æ–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –æ–±—Ä–∞–∑—Ü–∞–º–∏")
- –ß–µ–∫–±–æ–∫—Å—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:
  - `samples.create` - –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–æ–≤
  - `samples.update` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–æ–≤
  - `samples.delete` - –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–æ–≤
  - `cache.clear` - –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
  - `admin.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–≤ –¥–Ω—è—Ö)
- –ü–æ–∫–∞–∑ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ –æ–¥–∏–Ω —Ä–∞–∑ (—Å –∫–Ω–æ–ø–∫–æ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è)

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–ª—é—á–∞–º–∏:**
- –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–ª—é—á–µ–π
- –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö/–∏—Å—Ç—ë–∫—à–∏—Ö –∫–ª—é—á–µ–π

**–ê—É–¥–∏—Ç:**
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å ID API –∫–ª—é—á–∞
- –ë—ç–∫–µ–Ω–¥ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç, –∫–∞–∫–æ–π –∫–ª—é—á –≤–Ω—ë—Å –∫–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –°—á—ë—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –∏ –º–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (—Å –±—ç–∫–∞–ø–∞–º–∏)

1. **Backend:**
   - `~/DNA-utils-universal/backend/routes/admin.js`
   - –ë—ç–∫–∞–ø: `~/DNA-utils-universal/backend/routes/admin.js.bak`

2. **Frontend:**
   - `~/DNA-utils-universal/str-matcher/src/components/str-matcher/SampleManager.tsx`
   - –ë—ç–∫–∞–ø: –Ω–µ—Ç (–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ Git)

3. **–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
   - `~/DNA-utils-universal/str-matcher/src/app/admin/keys/page.tsx` (–Ω–æ–≤—ã–π)

---

## URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞

- **Sample Manager**: https://pystr.valalav.ru/samples
- **Admin Key Management**: https://pystr.valalav.ru/admin/keys

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑—Ü–∞–º–∏:
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/samples` –∏ –≤–≤–µ—Å—Ç–∏ API –∫–ª—é—á
2. –î–æ–±–∞–≤–∏—Ç—å, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –º–∞—Å—Å–æ–≤–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑—Ü—ã
3. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∂–∞—Ç—å "üîÑ Apply Changes"
4. –ö—ç—à –æ—á–∏—â–∞–µ—Ç—Å—è –∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–æ —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è API –∫–ª—é—á–∞–º–∏:
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/admin/keys`
2. –í–≤–µ—Å—Ç–∏ –º–∞—Å—Ç–µ—Ä API –∫–ª—é—á (–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `MASTER_API_KEY`)
3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ —Å:
   - –ò–º–µ–Ω–µ–º –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –û–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–ª—é—á–∞
   - –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)
5. –£–ø—Ä–∞–≤–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–ª—é—á–∞–º–∏ (–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å)
6. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –∞—É–¥–∏—Ç

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –±—ç–∫–µ–Ω–¥–∞

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ë—ç–∫–µ–Ω–¥ —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 9004) –∏–º–µ–µ—Ç –æ—à–∏–±–∫—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ PostgreSQL:
```
Error: password authentication failed for user
Code: 28P01
```

**–ì–¥–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
–§–∞–π–ª: `~/DNA-utils-universal/backend/.env` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Docker

**–ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
DB_HOST=localhost
DB_PORT=5432
DB_NAME=ystr_database  # –∏–ª–∏ –≤–∞—à–µ –∏–º—è –ë–î
DB_USER=postgres       # –∏–ª–∏ –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
DB_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å # –ò–°–ü–†–ê–í–ò–¢–¨
```

**–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥ –≤—Ä—É—á–Ω—É—é (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):**
```bash
cd ~/DNA-utils-universal/backend
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cat .env

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
node server.js
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
sudo systemctl status postgresql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω (–Ω—É–∂–µ–Ω –¥–ª—è –∫—ç—à–∞)
sudo systemctl status redis
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—é

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ü–†–ò–û–†–ò–¢–ï–¢ 1)

```bash
# –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ PostgreSQL
sudo systemctl status postgresql

# –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª
cd ~/DNA-utils-universal/backend
cat .env

# –®–∞–≥ 3: –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î –≤—Ä—É—á–Ω—É—é
psql -h localhost -U postgres -d ystr_database

# –®–∞–≥ 4: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ .env
nano .env
# –ò–∑–º–µ–Ω–∏—Ç—å DB_PASSWORD –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

# –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥
pkill -f "node.*server.js"
nohup node server.js > /tmp/backend.log 2>&1 &

# –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f /tmp/backend.log
```

### 2. –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π API –∫–ª—é—á (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î)

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å curl –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∫–ª—é—á–∞
curl -X POST http://localhost:9004/api/admin/keys \
  -H "Content-Type: application/json" \
  -H "X-API-Key: –≤–∞—à_–º–∞—Å—Ç–µ—Ä_–∫–ª—é—á" \
  -d '{
    "name": "–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",
    "description": "–ö–ª—é—á –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ –æ–±—Ä–∞–∑—Ü–∞–º–∏",
    "permissions": {
      "samples.create": true,
      "samples.update": true,
      "samples.delete": true,
      "cache.clear": true,
      "admin.read": true
    }
  }'
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

**–¢–µ—Å—Ç 1: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫—ç—à–∞**
```bash
# –ß–µ—Ä–µ–∑ curl
curl -X POST http://localhost:9004/api/admin/reload-cache \
  -H "Content-Type: application/json" \
  -H "X-API-Key: –≤–∞—à_api_–∫–ª—é—á" \
  -d '{"type": "all"}'

# –ò–ª–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
# 1. –ó–∞–π—Ç–∏ –Ω–∞ https://pystr.valalav.ru/samples
# 2. –í–≤–µ—Å—Ç–∏ API –∫–ª—é—á
# 3. –ù–∞–∂–∞—Ç—å "üîÑ Apply Changes"
```

**–¢–µ—Å—Ç 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏**
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª—é—á–µ–π
curl http://localhost:9004/api/admin/keys \
  -H "X-API-Key: –º–∞—Å—Ç–µ—Ä_–∫–ª—é—á"

# –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á
curl -X PUT http://localhost:9004/api/admin/keys/1 \
  -H "Content-Type: application/json" \
  -H "X-API-Key: –º–∞—Å—Ç–µ—Ä_–∫–ª—é—á" \
  -d '{"isActive": false}'
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∞

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –í —Ñ–∞–π–ª–µ ~/DNA-utils-universal/backend/.env
echo "MASTER_API_KEY=–≤–∞—à_–±–µ–∑–æ–ø–∞—Å–Ω—ã–π_–º–∞—Å—Ç–µ—Ä_–∫–ª—é—á" >> .env

# –ò–ª–∏ –≤ docker-compose.yml
environment:
  - MASTER_API_KEY=–≤–∞—à_–±–µ–∑–æ–ø–∞—Å–Ω—ã–π_–º–∞—Å—Ç–µ—Ä_–∫–ª—é—á
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–π –∫–ª—é—á, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–ª—é—á
openssl rand -hex 32
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–≤—ã—Ö –∫–ª—é—á–µ–π, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. **–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
   - –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å 1: —Ç–æ–ª—å–∫–æ `samples.create`, `samples.update`
   - –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å 2: —Ç–æ–ª—å–∫–æ `samples.create`
   - –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä: –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫—Ä–æ–º–µ `admin.read`

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–æ–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è:**
   - –î–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: 90-180 –¥–Ω–µ–π
   - –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö: –±–µ–∑ —Å—Ä–æ–∫–∞ –∏–ª–∏ 365 –¥–Ω–µ–π

3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞—É–¥–∏—Ç:**
   ```bash
   # –ü–æ–ª—É—á–∏—Ç—å –∞—É–¥–∏—Ç-–ª–æ–≥ (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç)
   curl http://localhost:9004/api/admin/audit \
     -H "X-API-Key: –º–∞—Å—Ç–µ—Ä_–∫–ª—é—á"
   ```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
~/DNA-utils-universal/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.js              # ‚úèÔ∏è –ò–ó–ú–ï–ù–Å–ù (–¥–æ–±–∞–≤–ª–µ–Ω /reload-cache)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.js.bak          # –ë—ç–∫–∞–ø
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keys.js               # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ samples.js            # CRUD –æ–±—Ä–∞–∑—Ü–æ–≤ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ apiKeyAuth.js         # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
‚îÇ   ‚îî‚îÄ‚îÄ server.js                 # –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
‚îÇ
‚îî‚îÄ‚îÄ str-matcher/
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ app/
        ‚îÇ   ‚îú‚îÄ‚îÄ admin/
        ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ keys/
        ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx  # ‚ú® –ù–û–í–´–ô (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏)
        ‚îÇ   ‚îî‚îÄ‚îÄ samples/
        ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx      # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π
        ‚îî‚îÄ‚îÄ components/
            ‚îî‚îÄ‚îÄ str-matcher/
                ‚îî‚îÄ‚îÄ SampleManager.tsx  # ‚úèÔ∏è –ò–ó–ú–ï–ù–Å–ù (–¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ Apply Changes)
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### API Endpoints

**–ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:**
```
POST /api/admin/reload-cache
Headers: X-API-Key: <api_key_with_cache.clear_permission>
Body: { "type": "all" | "matching" | "haplogroup" | "profiles" }
Response: {
  "success": true,
  "message": "Cache reloaded successfully...",
  "clearedTypes": ["matching", "haplogroup", "profiles"],
  "timestamp": "2025-10-11T...",
  "apiKey": "Key Name"
}
```

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∫–ª—é—á–µ–π:**
```
POST   /api/admin/keys              # –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á
GET    /api/admin/keys              # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª—é—á–µ–π
GET    /api/admin/keys/:id          # –î–µ—Ç–∞–ª–∏ –∫–ª—é—á–∞
PUT    /api/admin/keys/:id          # –û–±–Ω–æ–≤–∏—Ç—å –∫–ª—é—á
DELETE /api/admin/keys/:id          # –£–¥–∞–ª–∏—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á
```

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è (Permissions)

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:
- `samples.create` - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑—Ü–æ–≤
- `samples.update` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–±—Ä–∞–∑—Ü–æ–≤
- `samples.delete` - –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–æ–≤
- `cache.clear` - –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `admin.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- ‚úÖ Frontend (Next.js): **–†–ê–ë–û–¢–ê–ï–¢** –Ω–∞ –ø–æ—Ä—Ç—É 3000
  - URL: https://pystr.valalav.ru
  - Build ID: —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω
  - –í—Å–µ –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–∫–ª—é—á–µ–Ω—ã

- ‚ùå Backend (Express): **–ù–ï –†–ê–ë–û–¢–ê–ï–¢** (–æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î)
  - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ –ø–æ—Ä—Ç—É 9004
  - –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PostgreSQL

- ‚ùì PostgreSQL: –°—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω
- ‚ùì Redis: –°—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –ë–î –≤ .env
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥ —Å–µ—Ä–≤–µ—Ä
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞
- [ ] –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π API –∫–ª—é—á —á–µ—Ä–µ–∑ curl
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Sample Manager —Å –∫–Ω–æ–ø–∫–æ–π Apply Changes
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Admin Keys Page
- [ ] –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MASTER_API_KEY –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –∫–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
- –°–µ—Ä–≤–µ—Ä: valalav@192.168.10.170
- –ü–∞—Ä–æ–ª—å: 12343211
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞: ~/DNA-utils-universal

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

**–õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–ø–∏–∏ (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å Claude Code):**
- `/tmp/admin.js` - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π admin.js
- `/tmp/admin_keys_page.tsx` - –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏
- `/tmp/SampleManager.tsx` - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Sample Manager

**–õ–æ–≥–∏:**
- Next.js: `/tmp/next_prod.log`
- Backend: `/tmp/backend.log` (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á—ë—Ç–∞:** 2025-10-11
**–ê–≤—Ç–æ—Ä:** Claude (Anthropic)
**–í–µ—Ä—Å–∏—è:** 1.0
