# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã DNA-utils-universal

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

DNA-utils-universal –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ Y-STR –º–∞—Ä–∫–µ—Ä–æ–≤ –∏ —Ä–∞–±–æ—Ç—ã —Å –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø–∞–º–∏ Y-—Ö—Ä–æ–º–æ—Å–æ–º—ã. –°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —á–µ—Ä–µ–∑ HTTP API –∏ –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    DNA-utils-universal                          ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   str-matcher   ‚îÇ  ‚îÇ  ftdna_haplo   ‚îÇ  ‚îÇ ystr_predictor  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   (Next.js)     ‚îÇ  ‚îÇ   (Node.js)    ‚îÇ  ‚îÇ    (Python)     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   Port: 9002    ‚îÇ  ‚îÇ   Port: 9003   ‚îÇ  ‚îÇ   Port: 5000    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îÇ   React     ‚îÇ ‚îÇ  ‚îÇ ‚îÇ   Server   ‚îÇ ‚îÇ  ‚îÇ ‚îÇ   FastAPI   ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îÇ   Frontend  ‚îÇ‚óÑ‚îº‚îÄ‚îÄ‚îº‚ñ∫‚îÇ   Express  ‚îÇ ‚îÇ  ‚îÇ ‚îÇ   ML Model  ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îÇ             ‚îÇ ‚îÇ  ‚îÇ ‚îÇ            ‚îÇ ‚îÇ  ‚îÇ ‚îÇ             ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îÇ STR Matcher ‚îÇ ‚îÇ  ‚îÇ ‚îÇ HaploTree  ‚îÇ ‚îÇ  ‚îÇ ‚îÇ  Predictor  ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îÇ   Engine    ‚îÇ ‚îÇ  ‚îÇ ‚îÇ  Service   ‚îÇ ‚îÇ  ‚îÇ ‚îÇ   Engine    ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                 ‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îÇ   Workers   ‚îÇ ‚îÇ  ‚îÇ ‚îÇ React UI   ‚îÇ ‚îÇ  ‚îÇ                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îÇ             ‚îÇ ‚îÇ  ‚îÇ ‚îÇ (Vite)     ‚îÇ ‚îÇ  ‚îÇ                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îÇ                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. str-matcher (Next.js App Router, –ø–æ—Ä—Ç 9002)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è STR-–º–∞—Ä–∫–µ—Ä–æ–≤ –∏ –ø–æ–∏—Å–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**:
- Next.js 14 —Å App Router
- React 18 —Å —Ö—É–∫–∞–º–∏
- TypeScript
- Tailwind CSS
- Zustand –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
- Web Workers –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã**:
```
str-matcher/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx               # –û—Å–Ω–æ–≤–Ω–æ–π layout
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ globals.css              # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ str-matcher/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ STRMatcher.tsx       # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ STRMarkerGrid.tsx    # –°–µ—Ç–∫–∞ –º–∞—Ä–∫–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MatchesTable.tsx     # –¢–∞–±–ª–∏—Ü–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DatabaseInput.tsx    # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ HaplogroupFilter.tsx # –§–∏–ª—å—Ç—Ä –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/                      # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout/                  # Layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useSTRMatcher.ts         # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ STR
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useHaplogroups.ts        # –†–∞–±–æ—Ç–∞ —Å –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useTranslation.ts        # –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calculations.ts          # –ê–ª–≥–æ—Ä–∏—Ç–º—ã –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ constants.ts             # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –º–∞—Ä–∫–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ csvParser.ts             # –ü–∞—Ä—Å–∏–Ω–≥ CSV
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ markerOperations.ts      # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ storage.ts               # –†–∞–±–æ—Ç–∞ —Å localStorage
‚îÇ   ‚îú‚îÄ‚îÄ workers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ str-worker.ts            # Web Worker –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îÇ       ‚îî‚îÄ‚îÄ *.ts                     # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ next.config.js                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Next.js
‚îú‚îÄ‚îÄ tailwind.config.ts               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tailwind
‚îî‚îÄ‚îÄ package.json                     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

**–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç CSV —Ñ–∞–π–ª—ã —Å STR –¥–∞–Ω–Ω—ã–º–∏
2. –°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–∏—Ç –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
3. –í–≤–æ–¥—è—Ç—Å—è STR –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞
4. Web Worker –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
5. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### 2. ftdna_haplo (Node.js + React, –ø–æ—Ä—Ç—ã 9003/5173)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø–∞–º–∏, —Ñ–∏–ª–æ–≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–º–∏ –¥–µ—Ä–µ–≤—å—è–º–∏ –∏ SNP –∞–Ω–∞–ª–∏–∑–æ–º.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: Backend (Express) + Frontend (React/Vite)

#### Backend (server/, –ø–æ—Ä—Ç 9003)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**:
- Node.js + Express
- CORS –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- JSON —Ñ–∞–π–ª—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã**:
```
ftdna_haplo/server/
‚îú‚îÄ‚îÄ server.js                    # –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Express
‚îú‚îÄ‚îÄ haplo_functions.js           # –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø–∞–º–∏
‚îú‚îÄ‚îÄ tree_processor.js            # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–ª–æ–≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ä–µ–≤—å–µ–≤
‚îú‚îÄ‚îÄ yfull_adapter.js             # –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è YFull –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ search_integration.js        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
‚îú‚îÄ‚îÄ snp_matcher.js               # –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ SNP
‚îú‚îÄ‚îÄ path_builder.js              # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—É—Ç–µ–π –≤ –¥–µ—Ä–µ–≤–µ
‚îú‚îÄ‚îÄ path_resolver.js             # –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—É—Ç–µ–π
‚îú‚îÄ‚îÄ stepped_search.js            # –ü–æ—à–∞–≥–æ–≤—ã–π –ø–æ–∏—Å–∫
‚îú‚îÄ‚îÄ match_validator.js           # –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
‚îî‚îÄ‚îÄ services/
    ‚îî‚îÄ‚îÄ haplogroup-service.js    # –°–µ—Ä–≤–∏—Å –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø
```

**API Endpoints**:
- `GET /api/haplogroups` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø
- `GET /api/haplogroups/:id` - –î–µ—Ç–∞–ª–∏ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø—ã
- `POST /api/haplogroups/search` - –ü–æ–∏—Å–∫ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø
- `GET /api/tree/:haplogroup` - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞
- `POST /api/snp/match` - –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ SNP

#### Frontend (client/, –ø–æ—Ä—Ç 5173)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**:
- React 18
- Vite –¥–ª—è —Å–±–æ—Ä–∫–∏
- Tailwind CSS
- Fetch API –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã**:
```
ftdna_haplo/client/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/           # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/            # API —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ App.jsx              # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îú‚îÄ‚îÄ vite.config.js           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vite
‚îî‚îÄ‚îÄ package.json             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### 3. ystr_predictor (Python FastAPI, –ø–æ—Ä—Ç 5000)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø –Ω–∞ –æ—Å–Ω–æ–≤–µ STR –º–∞—Ä–∫–µ—Ä–æ–≤.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**:
- Python 3.9+
- FastAPI –¥–ª—è API
- Pandas –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- Scikit-learn –¥–ª—è ML
- Uvicorn –¥–ª—è ASGI —Å–µ—Ä–≤–µ—Ä–∞

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã**:
```
ystr_predictor/
‚îú‚îÄ‚îÄ app.py                   # –ì–ª–∞–≤–Ω–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ server.js                # Node.js –æ–±–µ—Ä—Ç–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞)
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ tree_predictor.py    # –û—Å–Ω–æ–≤–Ω–∞—è ML –º–æ–¥–µ–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ saved/               # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ api/                     # API endpoints
‚îú‚îÄ‚îÄ static/                  # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ requirements.txt         # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ ecosystem.config.js      # PM2 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

**API Endpoints**:
- `POST /api/predict` - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø—ã
- `POST /api/train` - –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
- `GET /api/model/status` - –°—Ç–∞—Ç—É—Å –º–æ–¥–µ–ª–∏

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫

### PM2 Process Manager

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ PM2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `ecosystem.config.js`:

```javascript
module.exports = {
  apps: [
    {
      name: "ftdna-haplo-app",
      cwd: "./ftdna_haplo",
      script: "./server/server.js",
      env_production: {
        NODE_ENV: "production",
        PORT: 9003,
        API_PATH: "/api"
      }
    },
    {
      name: "str-matcher-app", 
      cwd: "./str-matcher",
      script: "./node_modules/next/dist/bin/next",
      args: "start -p 9002",
      env_production: {
        NODE_ENV: "production",
        HAPLO_API_URL: "http://localhost:9003"
      }
    }
  ]
};
```

### –°–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞

**–ö–æ—Ä–Ω–µ–≤–æ–π package.json**:
```json
{
  "scripts": {
    "dev": "concurrently \"npm:dev:api\" \"npm:dev:client\"",
    "dev:api": "npm run dev --prefix ftdna_haplo/server", 
    "dev:client": "npm run dev --prefix str-matcher",
    "build": "npm run build:str-matcher && npm run build:haplo-client",
    "start": "cross-env NODE_ENV=production pm2 start ecosystem.config.js",
    "stop": "pm2 delete all"
  }
}
```

**Batch —Ñ–∞–π–ª—ã –¥–ª—è Windows**:
- `start.bat` - –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- `stop.ps1` - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤  
- `build-and-start.bat` - –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
- `build-only.bat` - –¢–æ–ª—å–∫–æ —Å–±–æ—Ä–∫–∞

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. str-matcher ‚Üî ftdna_haplo

**–ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤**:
```javascript
// next.config.js –≤ str-matcher
async rewrites() {
  return [
    {
      source: '/api/:path*',
      destination: 'http://localhost:9003/api/:path*',
    },
  ];
}
```

**–¢–∏–ø—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π**:
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –ü–æ–∏—Å–∫ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø –ø–æ STR –ø—Ä–æ—Ñ–∏–ª—è–º
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø

### 2. str-matcher ‚Üî ystr_predictor

**–ü—Ä—è–º—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã**:
```typescript
// –í str-matcher
const predictHaplogroup = async (markers: STRMarkers) => {
  const response = await fetch('http://localhost:5000/api/predict', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ markers })
  });
  return response.json();
};
```

### 3. ftdna_haplo ‚Üî ystr_predictor  

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ SearchIntegrator**:
```javascript
// search_integration.js
class SearchIntegrator {
  async integratedSearch(strProfile) {
    // 1. –ü–æ–∏—Å–∫ –≤ FTDNA –¥–∞–Ω–Ω—ã—Ö
    const ftdnaResults = await this.searchFTDNA(strProfile);
    
    // 2. –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —á–µ—Ä–µ–∑ ML –º–æ–¥–µ–ª—å
    const prediction = await this.predictWithML(strProfile);
    
    // 3. –ü–æ–∏—Å–∫ –≤ YFull –¥–∞–Ω–Ω—ã—Ö
    const yfullResults = await this.searchYFull(strProfile);
    
    return this.mergeResults(ftdnaResults, prediction, yfullResults);
  }
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### STR –ü—Ä–æ—Ñ–∏–ª—å
```typescript
interface STRProfile {
  id: string;
  markers: {
    [markerName: string]: number | null;
  };
  haplogroup?: string;
  source?: 'FTDNA' | 'YFull' | 'Custom';
  kitNumber?: string;
  ancestralNames?: string[];
}
```

### –ì–∞–ø–ª–æ–≥—Ä—É–ø–ø–∞
```typescript
interface Haplogroup {
  id: string;
  name: string;
  parent?: string;
  children: string[];
  snps: string[];
  equivalents?: string[];
  level: number;
}
```

### STR –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```typescript
interface STRMatch {
  profile: STRProfile;
  distance: number;
  matchedMarkers: number;
  totalMarkers: number;
  differences: {
    [markerName: string]: {
      query: number;
      match: number;
      difference: number;
    };
  };
}
```

## –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
```
data/
‚îú‚îÄ‚îÄ get.json              # FTDNA –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ ytree.json           # YFull –¥–µ—Ä–µ–≤–æ  
‚îú‚îÄ‚îÄ haplogroups.json     # –ö—ç—à –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø
‚îî‚îÄ‚îÄ cache/               # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏
- **HaploTree**: –î–µ—Ä–µ–≤–æ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- **STR Database**: –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é, –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
- **Search Results**: –ö—ç—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –†–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–∞–≤–≥—É—Å—Ç 2025)

#### Streaming –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤:

```typescript
// –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –ø–æ—Ç–æ–∫–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –∏–∑ IndexedDB
async streamProfiles(
  callback: (profiles: STRProfile[]) => void,
  batchSize: number = 1000
): Promise<void> {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ 1000 –ø—Ä–æ—Ñ–∏–ª–µ–π —Å –ø–∞—É–∑–∞–º–∏ –¥–ª—è UI
  const cursor = await this.store.openCursor();
  let batch: STRProfile[] = [];
  
  while (cursor) {
    batch.push(cursor.value);
    
    if (batch.length >= batchSize) {
      await callback(batch);
      batch = [];
      await new Promise(resolve => setTimeout(resolve, 0)); // UI pause
    }
    
    await cursor.continue();
  }
}
```

#### Memory Management Revolution
- **–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**: 150k –ø—Ä–æ—Ñ–∏–ª–µ–π = ~500MB –≤ RAM –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
- **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**: <50MB –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, –ø–∏–∫–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ~100MB

#### Web Workers –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```typescript
// –¢—Ä–µ—Ö—ç—Ç–∞–ø–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ Worker
self.onmessage = function(e) {
  switch (e.data.type) {
    case 'init':         // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
      initializeWorker();
      break;
    case 'processBatch': // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ä—Ü–∏—è–º–∏ –ø–æ 1000
      processBatchAsync(e.data.batch);
      break;
    case 'finalize':     // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      finalizeResults();
      break;
  }
};
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–π–ª–æ–≤**: –¥–æ 300k+ –ø—Ä–æ—Ñ–∏–ª–µ–π (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ)
- **–í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞**: <20 —Å–µ–∫—É–Ω–¥ –¥–ª—è 150k –ø—Ä–æ—Ñ–∏–ª–µ–π
- **UI –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å**: 100% —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **–ü–∞–º—è—Ç—å**: 95% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è RAM

### Web Workers (str-matcher)
```typescript
// workers/str-worker.ts
self.onmessage = function(e) {
  const { database, query, filters } = e.data;
  
  // –¢—è–∂–µ–ª—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
  const matches = calculateMatches(database, query, filters);
  
  self.postMessage({ matches, completed: true });
};
```

### –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```typescript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –ø–æ —á–∞—Å—Ç—è–º
const processInBatches = async (data: any[], batchSize = 1000) => {
  for (let i = 0; i < data.length; i += batchSize) {
    const batch = data.slice(i, i + batchSize);
    await processBatch(batch);
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
    updateProgress((i + batchSize) / data.length);
  }
};
```

### –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
const createIndexes = (database) => {
  const haplogroupIndex = new Map();
  const markerIndex = new Map();
  
  database.forEach(profile => {
    // –ò–Ω–¥–µ–∫—Å –ø–æ –≥–∞–ø–ª–æ–≥—Ä—É–ø–ø–∞–º
    if (profile.haplogroup) {
      if (!haplogroupIndex.has(profile.haplogroup)) {
        haplogroupIndex.set(profile.haplogroup, []);
      }
      haplogroupIndex.get(profile.haplogroup).push(profile);
    }
    
    // –ò–Ω–¥–µ–∫—Å –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º
    Object.keys(profile.markers).forEach(marker => {
      if (!markerIndex.has(marker)) {
        markerIndex.set(marker, new Map());
      }
      const value = profile.markers[marker];
      if (value !== null) {
        if (!markerIndex.get(marker).has(value)) {
          markerIndex.get(marker).set(value, []);
        }
        markerIndex.get(marker).get(value).push(profile);
      }
    });
  });
  
  return { haplogroupIndex, markerIndex };
};
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```javascript
// ftdna_haplo/server/server.js
app.use(cors({
  origin: function (origin, callback) {
    const allowedOrigins = [
      'http://localhost:9002',    // str-matcher –≤ dev
      'http://localhost:3000',    // –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç
      'http://localhost:5173'     // ftdna_haplo client
    ];
    
    if (!origin || allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true
}));
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```typescript
// utils/validation.ts
export const validateSTRProfile = (profile: any): boolean => {
  if (!profile || typeof profile !== 'object') return false;
  if (!profile.markers || typeof profile.markers !== 'object') return false;
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ä–∫–µ—Ä–æ–≤
  for (const [marker, value] of Object.entries(profile.markers)) {
    if (value !== null && (typeof value !== 'number' || value < 0)) {
      return false;
    }
  }
  
  return true;
};
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```typescript
// utils/error-handling.ts
export class AppError extends Error {
  constructor(
    public message: string,
    public code: string,
    public statusCode: number = 500
  ) {
    super(message);
    this.name = 'AppError';
  }
}

export const errorHandler = (error: any, req: any, res: any, next: any) => {
  if (error instanceof AppError) {
    return res.status(error.statusCode).json({
      error: {
        message: error.message,
        code: error.code
      }
    });
  }
  
  console.error('Unhandled error:', error);
  res.status(500).json({
    error: {
      message: 'Internal server error',
      code: 'INTERNAL_ERROR'
    }
  });
};
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```typescript
// utils/logger.ts
export enum LogLevel {
  DEBUG = 0,
  INFO = 1,
  WARN = 2,
  ERROR = 3
}

export class Logger {
  constructor(private context: string) {}
  
  info(message: string, data?: any) {
    console.log(`[${this.context}] INFO: ${message}`, data || '');
  }
  
  error(message: string, error?: any) {
    console.error(`[${this.context}] ERROR: ${message}`, error || '');
  }
  
  warn(message: string, data?: any) {
    console.warn(`[${this.context}] WARN: ${message}`, data || '');
  }
}
```

### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```typescript
// utils/metrics.ts
export const performanceMetrics = {
  startTimer: (operation: string) => {
    const start = performance.now();
    return {
      end: () => {
        const duration = performance.now() - start;
        console.log(`${operation} took ${duration.toFixed(2)}ms`);
        return duration;
      }
    };
  },
  
  measureMemory: () => {
    if ('memory' in performance) {
      return (performance as any).memory;
    }
    return null;
  }
};
```
