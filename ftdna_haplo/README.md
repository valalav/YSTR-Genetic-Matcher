# FTDNA Haplo App - Универсальное развертывание

Это приложение настроено для универсального развертывания. Единый сервер Express отвечает за раздачу API и статических файлов клиентского приложения (React). Такая архитектура исключает проблемы с CORS и упрощает развертывание.

## Требования

- Node.js (версия 14.x или выше)
- npm
- pm2 (глобально установленный: `npm install pm2 -g`)

## Инструкция по развертыванию

### 1. Копирование файлов на сервер

Скопируйте все содержимое этой директории (`ftdna_haplo`) на ваш сервер.

**ВАЖНО:** Убедитесь, что вы скопировали папку `data` со всеми ее файлами (`get.json`, `ytree.json` и др.). Без этих файлов сервер не сможет запуститься.

### 2. Установка зависимостей

Сначала необходимо установить зависимости для сервера и клиента.

```bash
# Установка зависимостей сервера из корневой папки ftdna_haplo
npm install

# Установка зависимостей клиента
cd client
npm install
cd ..
```

### 2. Сборка клиентского приложения

Перед запуском производственной версии необходимо собрать клиентское приложение. Эта команда создаст оптимизированные статические файлы в папке `client/dist`.

```bash
# Запуск сборки клиента из папки ftdna_haplo
npm run build --prefix client
```

### 3. Запуск приложения с помощью PM2

Используйте `ecosystem.config.js` для запуска приложения в производственном режиме с помощью PM2. PM2 будет управлять процессом, автоматически перезапускать его в случае сбоев и обеспечивать бесперебойную работу.

```bash
# Запуск сервера из корневой папки ftdna_haplo
pm2 start ecosystem.config.js
```

После выполнения этой команды ваше приложение будет доступно по адресу `http://<ваш_сервер>:9003`.

## Локальная разработка

Для локальной разработки вам нужно запустить два процесса в двух разных терминалах.

### Терминал 1: Запуск сервера

```bash
# Из папки ftdna_haplo
npm run dev --prefix server
```

### Терминал 2: Запуск клиента

```bash
# Из папки ftdna_haplo/client
npm run dev
```

Клиент будет доступен по адресу `http://localhost:5173` и будет автоматически использовать прокси для всех запросов к API на `http://localhost:9003`.