# ‚úÖ Sample Manager - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

## –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: 2025-10-11

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. ‚úÖ –ö–Ω–æ–ø–∫–∞ "Apply Changes" –¥–ª—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –∫—ç—à–∞

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑—Ü–æ–≤ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –º–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üîÑ Apply Changes"
- –ö—ç—à –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—á–∏—â–∞–µ—Ç—Å—è (matching, haplogroup, profiles)
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–æ —Å–≤–µ–∂–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è - –º–æ–∂–Ω–æ –Ω–∞–∫–æ–ø–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–æ–∫

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- Frontend: `~/DNA-utils-universal/str-matcher/src/components/str-matcher/SampleManager.tsx:332-337`
- Backend: `~/DNA-utils-universal/backend/routes/admin.js:410-450`

**API Endpoint:**
```
POST /api/admin/reload-cache
Headers: X-API-Key: <api_key_with_cache.clear_permission>
Body: { "type": "all" | "matching" | "haplogroup" | "profiles" }
```

---

### 2. ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è API –∫–ª—é—á–∞–º–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á API
- –ó–∞—â–∏—â—ë–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω–æ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏
- **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π** —Å:
  - –ò–º–µ–Ω–µ–º (–¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤")
  - –û–ø–∏—Å–∞–Ω–∏–µ–º (–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª—é—á–∞)
  - –ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏:
    - `samples.create` - –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–æ–≤
    - `samples.update` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–æ–≤
    - `samples.delete` - –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–æ–≤
    - `cache.clear` - –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
    - `admin.read` - –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã—Ö
  - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è (–≤ –¥–Ω—è—Ö)

- **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–ª—é—á–µ–π** —Å:
  - –ò–º–µ–Ω–µ–º –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º
  - –°—Ç–∞—Ç—É—Å–æ–º (–ê–∫—Ç–∏–≤–µ–Ω/–ù–µ–∞–∫—Ç–∏–≤–µ–Ω/–ò—Å—Ç—ë–∫)
  - –°–ø–∏—Å–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
  - –î–∞—Ç–æ–π —Å–æ–∑–¥–∞–Ω–∏—è, –∏—Å—Ç–µ—á–µ–Ω–∏—è, –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –°—á—ë—Ç—á–∏–∫–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π

- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–ª—é—á–∞–º–∏:**
  - –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
  - –£–¥–∞–ª–µ–Ω–∏–µ (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

#### –ê—É–¥–∏—Ç
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å ID API –∫–ª—é—á–∞
- –ú–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –∫–∞–∫–æ–π –∫–ª—é—á (–∫–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) –≤–Ω—ë—Å –∫–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –°—á—ë—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- Frontend: `~/DNA-utils-universal/str-matcher/src/app/admin/keys/page.tsx`
- Backend: `~/DNA-utils-universal/backend/routes/keys.js` (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)

---

## üåê URL-–∞–¥—Ä–µ—Å–∞

| –°—Ç—Ä–∞–Ω–∏—Ü–∞ | URL | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è |
|----------|-----|------------|
| Sample Manager | https://pystr.valalav.ru/samples | API –∫–ª—é—á —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –æ–±—Ä–∞–∑—Ü—ã |
| Admin Keys Management | https://pystr.valalav.ru/admin/keys | –ú–∞—Å—Ç–µ—Ä API –∫–ª—é—á |
| Backend API | http://localhost:9004 | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ—Å—Ç—É–ø |

---

## üîë –ú–∞—Å—Ç–µ—Ä API –∫–ª—é—á

–¢–µ–∫—É—â–∏–π –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á (–∏–∑ .env):
```
master_dna_2025_ultra_secure_key_change_this_in_production
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∫–ª—é—á –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–∞ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π:
```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–ª—é—á
openssl rand -hex 32

# –û–±–Ω–æ–≤–∏—Ç—å –≤ —Ñ–∞–π–ª–µ
cd ~/DNA-utils-universal/backend
nano .env
# –ò–∑–º–µ–Ω–∏—Ç—å MASTER_API_KEY –Ω–∞ –Ω–æ–≤—ã–π –∫–ª—é—á
```

---

## üß™ –¢–µ—Å—Ç–æ–≤—ã–π API –∫–ª—é—á

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—ã–ª —Å–æ–∑–¥–∞–Ω –∫–ª—é—á —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏:
```
–ò–º—è: Test Admin Key
–ö–ª—é—á: 8e9713e1214545ff804b02b0482183aeb52ce51baa96fbaea8f7144fa78782ca
–†–∞–∑—Ä–µ—à–µ–Ω–∏—è: samples.create, samples.update, samples.delete, cache.clear, admin.read
```

---

## üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ API –∫–ª—é—á–µ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://pystr.valalav.ru/admin/keys
2. –í–æ–π–¥–∏—Ç–µ —Å –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–æ–º: `master_dna_2025_ultra_secure_key_change_this_in_production`
3. –ù–∞–∂–º–∏—Ç–µ "Create New API Key"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   ```
   –ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
   –û–ø–∏—Å–∞–Ω–∏–µ: –ö–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Ä—Ö–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –æ–±—Ä–∞–∑—Ü–∞–º–∏
   –†–∞–∑—Ä–µ—à–µ–Ω–∏—è: ‚úì samples.create, ‚úì samples.update
   –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 365 –¥–Ω–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   ```
5. –ù–∞–∂–º–∏—Ç–µ "Create Key"
6. **–í–ê–ñ–ù–û:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á - –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω!
7. –ü–µ—Ä–µ–¥–∞–π—Ç–µ –∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ò–≤–∞–Ω—É –ò–≤–∞–Ω–æ–≤—É

#### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–ª—é—á–∞–º–∏

- **–ü—Ä–æ—Å–º–æ—Ç—Ä:** –í—Å–µ –∫–ª—é—á–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–∞–º–∏
- **–î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è:** –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **–£–¥–∞–ª–µ–Ω–∏–µ:** –ö–Ω–æ–ø–∫–∞ "Delete" –¥–ª—è –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- **–ê—É–¥–∏—Ç:** –°–º–æ—Ç—Ä–∏—Ç–µ "Last Used" –∏ "Usage Count" –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ä–∞–±–æ—Ç–∞ —Å –æ–±—Ä–∞–∑—Ü–∞–º–∏)

#### 1. –í—Ö–æ–¥ –≤ Sample Manager

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://pystr.valalav.ru/samples
2. –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ API –∫–ª—é—á
3. –ù–∞–∂–º–∏—Ç–µ "Authenticate"

#### 2. –†–∞–±–æ—Ç–∞ —Å –æ–±—Ä–∞–∑—Ü–∞–º–∏

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–∑—Ü–∞:**
1. –ù–∞–∂–º–∏—Ç–µ "Add Sample"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É (Kit Number, Location, Haplogroup, etc.)
3. –ù–∞–∂–º–∏—Ç–µ "Save"

**–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–∞:**
1. –ù–∞–∂–º–∏—Ç–µ "Edit" –Ω–∞–ø—Ä–æ—Ç–∏–≤ –Ω—É–∂–Ω–æ–≥–æ –æ–±—Ä–∞–∑—Ü–∞
2. –ò–∑–º–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ
3. –ù–∞–∂–º–∏—Ç–µ "Save"

**–ú–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç:**
1. –ù–∞–∂–º–∏—Ç–µ "Bulk Import"
2. –í—ã–±–µ—Ä–∏—Ç–µ CSV —Ñ–∞–π–ª —Å –æ–±—Ä–∞–∑—Ü–∞–º–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
4. –ù–∞–∂–º–∏—Ç–µ "Import"

#### 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ü–æ—Å–ª–µ –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–π:**
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üîÑ Apply Changes" (—Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É)
2. –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ
3. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ú–æ–∂–Ω–æ –Ω–∞–∫–æ–ø–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Ö –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π, –Ω–µ –Ω—É–∂–Ω–æ –Ω–∞–∂–∏–º–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Frontend (Next.js)                     ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  /samples - Sample Manager                      ‚îÇ
‚îÇ    ‚îî‚îÄ SampleManager.tsx                         ‚îÇ
‚îÇ       ‚îî‚îÄ "Apply Changes" button                 ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  /admin/keys - API Keys Management              ‚îÇ
‚îÇ    ‚îî‚îÄ page.tsx                                  ‚îÇ
‚îÇ       ‚îú‚îÄ Create keys with permissions           ‚îÇ
‚îÇ       ‚îú‚îÄ View all keys with audit info          ‚îÇ
‚îÇ       ‚îî‚îÄ Manage keys (activate/delete)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì HTTPS
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Backend (Express.js)                   ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  POST /api/admin/reload-cache                   ‚îÇ
‚îÇ    ‚îî‚îÄ Clears matching, haplogroup, profiles     ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  POST /api/admin/keys                           ‚îÇ
‚îÇ    ‚îî‚îÄ Creates new API key                       ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  GET /api/admin/keys                            ‚îÇ
‚îÇ    ‚îî‚îÄ Lists all keys with audit info            ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  PUT /api/admin/keys/:id                        ‚îÇ
‚îÇ    ‚îî‚îÄ Updates key (activate/deactivate)         ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  DELETE /api/admin/keys/:id                     ‚îÇ
‚îÇ    ‚îî‚îÄ Soft deletes key                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PostgreSQL Database (Docker)                  ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ   Tables:                                       ‚îÇ
‚îÇ   - api_keys (with permissions JSONB)           ‚îÇ
‚îÇ   - genetic_profiles                            ‚îÇ
‚îÇ   - haplogroups                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Redis Cache (Docker)                          ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ   Cache keys:                                   ‚îÇ
‚îÇ   - matching:*                                  ‚îÇ
‚îÇ   - haplogroup:tree                             ‚îÇ
‚îÇ   - profile:*                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### API Endpoints

#### 1. Reload Cache

```http
POST /api/admin/reload-cache
Headers: 
  Content-Type: application/json
  X-API-Key: <api_key_with_cache.clear_permission>
Body:
  {
    "type": "all" | "matching" | "haplogroup" | "profiles"
  }

Response 200:
  {
    "success": true,
    "message": "Cache reloaded successfully. Cleared 3 cache type(s).",
    "clearedTypes": ["matching", "haplogroup", "profiles"],
    "timestamp": "2025-10-11T09:18:34.563Z",
    "apiKey": "Test Admin Key"
  }
```

#### 2. Create API Key

```http
POST /api/admin/keys
Headers: 
  Content-Type: application/json
  X-API-Key: <master_api_key>
Body:
  {
    "name": "User Name",
    "description": "Purpose of this key",
    "permissions": {
      "samples.create": true,
      "samples.update": true,
      "samples.delete": false,
      "cache.clear": true,
      "admin.read": false
    },
    "expiresInDays": 365  // optional
  }

Response 200:
  {
    "success": true,
    "message": "API key created successfully...",
    "apiKey": "8e9713e1214545ff...",  // shown only once!
    "keyInfo": {
      "id": 65,
      "name": "User Name",
      "permissions": {...},
      "createdAt": "2025-10-11T09:18:26.216Z",
      "expiresAt": null,
      "isActive": true
    }
  }
```

#### 3. List All Keys

```http
GET /api/admin/keys
Headers: 
  X-API-Key: <master_api_key>

Response 200:
  {
    "success": true,
    "keys": [
      {
        "id": 65,
        "name": "Test Admin Key",
        "description": "Key for testing",
        "permissions": {...},
        "created_at": "2025-10-11T09:18:26.216Z",
        "expires_at": null,
        "is_active": true,
        "last_used_at": "2025-10-11T09:20:00.000Z",
        "usage_count": 5
      },
      ...
    ],
    "total": 21
  }
```

#### 4. Update Key

```http
PUT /api/admin/keys/:id
Headers: 
  Content-Type: application/json
  X-API-Key: <master_api_key>
Body:
  {
    "isActive": false  // or other fields to update
  }

Response 200:
  {
    "success": true,
    "message": "API key updated successfully",
    "key": {...}
  }
```

#### 5. Delete Key

```http
DELETE /api/admin/keys/:id
Headers: 
  X-API-Key: <master_api_key>

Response 200:
  {
    "success": true,
    "message": "API key deleted successfully"
  }
```

---

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è (Permissions)

| –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ |
|-----------|----------|---------------|
| `samples.create` | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑—Ü–æ–≤ | Sample Manager |
| `samples.update` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–±—Ä–∞–∑—Ü–æ–≤ | Sample Manager |
| `samples.delete` | –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑—Ü–æ–≤ | Sample Manager |
| `cache.clear` | –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ (–∫–Ω–æ–ø–∫–∞ Apply Changes) | Sample Manager |
| `admin.read` | –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | Admin endpoints |

---

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
~/DNA-utils-universal/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.js              ‚úèÔ∏è –ò–ó–ú–ï–ù–Å–ù (+reload-cache endpoint)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.js.bak          (–±—ç–∫–∞–ø)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keys.js               (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏, —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ samples.js            (CRUD –æ–±—Ä–∞–∑—Ü–æ–≤, —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ apiKeyAuth.js         (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ API –∫–ª—é—á—É)
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.js           (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL)
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ matchingService.js    (–∫—ç—à matching)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ haplogroupService.js  (–∫—ç—à haplogroup)
‚îÇ   ‚îú‚îÄ‚îÄ .env                      ‚úèÔ∏è –ò–°–ü–†–ê–í–õ–ï–ù (DB_PASSWORD=postgres)
‚îÇ   ‚îî‚îÄ‚îÄ server.js                 ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ (–ø–æ—Ä—Ç 9004)
‚îÇ
‚îî‚îÄ‚îÄ str-matcher/
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ app/
        ‚îÇ   ‚îú‚îÄ‚îÄ admin/
        ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ keys/
        ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx  ‚ú® –ù–û–í–´–ô (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏)
        ‚îÇ   ‚îî‚îÄ‚îÄ samples/
        ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx      (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
        ‚îú‚îÄ‚îÄ components/
        ‚îÇ   ‚îî‚îÄ‚îÄ str-matcher/
        ‚îÇ       ‚îî‚îÄ‚îÄ SampleManager.tsx  ‚úèÔ∏è –ò–ó–ú–ï–ù–Å–ù (+–∫–Ω–æ–ø–∫–∞ Apply Changes)
        ‚îî‚îÄ‚îÄ .next/                ‚úÖ –ü–ï–†–ï–°–û–ë–†–ê–ù (—Å –Ω–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏)
```

---

## üöÄ –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤

### ‚úÖ Backend (Express.js)
- **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç
- **–ü–æ—Ä—Ç:** 9004
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –ü–æ–¥–∫–ª—é—á–µ–Ω–∞ (PostgreSQL)
- **–ö—ç—à:** –ü–æ–¥–∫–ª—é—á–µ–Ω (Redis)
- **–õ–æ–≥–∏:** `/tmp/backend_fixed.log`

### ‚úÖ Frontend (Next.js)
- **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç
- **–ü–æ—Ä—Ç:** 3000
- **URL:** https://pystr.valalav.ru
- **–°–±–æ—Ä–∫–∞:** –ê–∫—Ç—É–∞–ª—å–Ω–∞—è (–≤–∫–ª—é—á–µ–Ω—ã /admin/keys –∏ /samples)
- **–õ–æ–≥–∏:** `/tmp/next_prod.log`

### ‚úÖ PostgreSQL
- **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç (Docker)
- **–ü–æ—Ä—Ç:** 5432
- **–ë–∞–∑–∞:** ystr_matcher
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** ystr-postgres

### ‚úÖ Redis
- **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç (Docker)
- **–ü–æ—Ä—Ç:** 6379
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** ystr-redis

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ö†Ô∏è Haplogroup Tree Warning (–Ω–µ–∫—Ä–∏—Ç–∏—á–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
‚ùå Error loading haplogroup tree: recursive query "haplogroup_tree" 
column 4 has type character varying(50)[] in non-recursive term 
but type character varying[] overall
```

**–°—Ç–∞—Ç—É—Å:** –ù–µ–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã Sample Manager –∏ API Keys
**–í–ª–∏—è–Ω–∏–µ:** –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
**–†–µ—à–µ–Ω–∏–µ:** –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∂–µ, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ —Å haplogroup tree

---

## üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

**Backend:**
```bash
cd ~/DNA-utils-universal/backend
pkill -f "node.*server.js"
nohup node server.js > /tmp/backend.log 2>&1 &
tail -f /tmp/backend.log
```

**Frontend:**
```bash
cd ~/DNA-utils-universal/str-matcher
echo '12343211' | sudo -S fuser -k 3000/tcp
nohup ./node_modules/.bin/next start -p 3000 > /tmp/next_prod.log 2>&1 &
tail -f /tmp/next_prod.log
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:**
```bash
# Backend health
curl http://localhost:9004/health

# Frontend accessibility
curl https://pystr.valalav.ru/
```

---

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# Backend
tail -f /tmp/backend_fixed.log

# Frontend
tail -f /tmp/next_prod.log

# PostgreSQL (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
echo '12343211' | sudo -S docker logs ystr-postgres

# Redis (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
echo '12343211' | sudo -S docker logs ystr-redis
```

---

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ë—ç–∫–∞–ø—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã:**
- `~/DNA-utils-universal/backend/routes/admin.js.bak`

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã:**
```bash
# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
echo '12343211' | sudo -S docker exec ystr-postgres \
  pg_dump -U postgres ystr_matcher > /tmp/ystr_matcher_$(date +%Y%m%d).sql

# –ë—ç–∫–∞–ø –∫–æ–¥–∞
cd ~/DNA-utils-universal
tar -czf /tmp/dna-utils-backup-$(date +%Y%m%d).tar.gz \
  backend/ str-matcher/src/ --exclude=node_modules --exclude=.next
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X POST http://localhost:9004/api/admin/keys \
  -H "Content-Type: application/json" \
  -H "X-API-Key: master_dna_2025_ultra_secure_key_change_this_in_production" \
  -d '{
    "name": "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞",
    "description": "–ö–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–±—Ä–∞–∑—Ü–∞–º–∏, –ø—Ä–æ–µ–∫—Ç 2025",
    "permissions": {
      "samples.create": true,
      "samples.update": true,
      "samples.delete": false,
      "cache.clear": false,
      "admin.read": false
    },
    "expiresInDays": 180
  }'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–æ–∑–¥–∞–Ω –∫–ª—é—á —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ö–ª—é—á –∏—Å—Ç–µ—á—ë—Ç —á–µ—Ä–µ–∑ 180 –¥–Ω–µ–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –æ–±—Ä–∞–∑—Ü—ã –∏–ª–∏ –æ—á–∏—â–∞—Ç—å –∫—ç—à

---

### –ü—Ä–∏–º–µ—Ä 2: –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å Sample Manager

```
1. –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç API –∫–ª—é—á –æ—Ç –∞–¥–º–∏–Ω–∞
   ‚Üì
2. –ó–∞—Ö–æ–¥–∏—Ç –Ω–∞ https://pystr.valalav.ru/samples
   ‚Üì
3. –í–≤–æ–¥–∏—Ç API –∫–ª—é—á, –Ω–∞–∂–∏–º–∞–µ—Ç "Authenticate"
   ‚Üì
4. –î–æ–±–∞–≤–ª—è–µ—Ç 10 –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑—Ü–æ–≤ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
   ‚Üì
5. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç CSV —Å 50 –æ–±—Ä–∞–∑—Ü–∞–º–∏
   ‚Üì
6. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç 3 –æ–±—Ä–∞–∑—Ü–∞ (–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—á–∞—Ç–∫–∏)
   ‚Üì
7. –ù–∞–∂–∏–º–∞–µ—Ç "üîÑ Apply Changes"
   ‚Üì
8. –ö—ç—à –æ—á–∏—â–∞–µ—Ç—Å—è, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
   ‚Üì
9. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ
```

**–í–∞–∂–Ω–æ:** –ö–Ω–æ–ø–∫—É "Apply Changes" –Ω—É–∂–Ω–æ –Ω–∞–∂–∏–º–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–∞–≤–æ–∫, –∞ –Ω–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

---

### –ü—Ä–∏–º–µ—Ä 3: –ê—É–¥–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–π

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª—é—á–µ–π —Å –∞—É–¥–∏—Ç–æ–º
curl -s http://localhost:9004/api/admin/keys \
  -H "X-API-Key: master_dna_2025_ultra_secure_key_change_this_in_production" \
  | python3 -m json.tool

# –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∂–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞:
# - usage_count: —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
# - last_used_at: –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
# - created_at: –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–Ω
# - name: –∫—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü
```

---

## üéì –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–æ–º

- ‚úÖ –•—Ä–∞–Ω–∏—Ç–µ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–π—Ç–µ –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á (—Ä–∞–∑ –≤ 6 –º–µ—Å—è—Ü–µ–≤)
- ‚úÖ –ù–µ –¥–µ–ª–∏—Ç–µ—Å—å –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–æ–º —Å –æ–±—ã—á–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–π –∫–ª—é—á (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–ª—é—á–µ–π

- ‚úÖ –í—ã–¥–∞–≤–∞–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤
- ‚úÖ –ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ, –∫–æ–º—É –∏ –∫–æ–≥–¥–∞ –≤—ã–¥–∞–ª–∏ –∫–ª—é—á (–≤–Ω–µ—à–Ω–∏–π —É—á—ë—Ç)

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ `usage_count` –∏ `last_used_at`
- ‚úÖ –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª—é—á–∏
- ‚úÖ –£–¥–∞–ª—è–π—Ç–µ –∫–ª—é—á–∏ —É–≤–æ–ª–∏–≤—à–∏—Ö—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### 4. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ –î–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
- ‚úÖ –•—Ä–∞–Ω–∏—Ç–µ –±—ç–∫–∞–ø—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–æ–≤
- ‚úÖ –ë—ç–∫–∞–ø—ã –∫–æ–¥–∞ –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å .env —Ñ–∞–π–ª—ã (–≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ)

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–ø—É—Å–∫–∞

- [x] PostgreSQL –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [x] Redis –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [x] –ü–∞—Ä–æ–ª—å –ë–î –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤ .env (postgres)
- [x] Backend —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 9004
- [x] Backend –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ PostgreSQL
- [x] Backend –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ Redis
- [x] –≠–Ω–¥–ø–æ–∏–Ω—Ç /api/admin/reload-cache —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Frontend —Å–æ–±—Ä–∞–Ω —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
- [x] Next.js —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000
- [x] –°—Ç—Ä–∞–Ω–∏—Ü–∞ /samples –¥–æ—Å—Ç—É–ø–Ω–∞
- [x] –°—Ç—Ä–∞–Ω–∏—Ü–∞ /admin/keys –¥–æ—Å—Ç—É–ø–Ω–∞
- [x] –ö–Ω–æ–ø–∫–∞ "Apply Changes" –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ Sample Manager
- [x] –ú–∞—Å—Ç–µ—Ä API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [x] –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π API –∫–ª—é—á —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   tail -f /tmp/backend_fixed.log
   tail -f /tmp/next_prod.log
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:
   ```bash
   curl http://localhost:9004/health
   curl https://pystr.valalav.ru/
   echo '12343211' | sudo -S docker ps
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã (—Å–º. —Ä–∞–∑–¥–µ–ª "–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ")

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:

1. ‚úÖ **–ö–Ω–æ–ø–∫–∞ "Apply Changes"** - –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–¥–Ω–∏–º –¥–µ–π—Å—Ç–≤–∏–µ–º
2. ‚úÖ **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è API –∫–ª—é—á–∞–º–∏** - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–ª—é—á–∞–º–∏ —Å –∞—É–¥–∏—Ç–æ–º
3. ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π** - –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. ‚úÖ **–ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –≤–Ω–æ—Å–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–î–∞—Ç–∞:** 2025-10-11  
**–ê–≤—Ç–æ—Ä:** Claude (Anthropic)  
**–ü—Ä–æ–µ–∫—Ç:** DNA-utils-universal / STR Matcher
